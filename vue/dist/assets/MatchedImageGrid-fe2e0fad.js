import{d as fe,r as ve,m as _,az as G,a1 as ke,U as m,V as S,c as s,a4 as e,a3 as n,a6 as B,W as c,L as he,Y as o,X as r,a2 as U,af as Ie,aS as we,$ as y,ag as L,ai as Ce,T as _e,ak as N,aP as Se,aQ as ye,bD as be,a0 as xe}from"./index-e00fca09.js";import{S as Me}from"./index-5fd01f66.js";import{o as P,L as Te,R as Ae,f as Ve,M as $e}from"./MultiSelectKeep-efcf9a94.js";import{c as De,d as Fe,F as Re}from"./FileItem-f83114db.js";import{c as ze,u as Ge}from"./hook-fd0f3453.js";import"./shortcut-b1aea8ae.js";import"./Checkbox-6e118156.js";/* empty css              */import"./numInput.vue_vue_type_style_index_0_scoped_55978858_lang-a64418bd.js";import"./index-246ad13a.js";import"./index-e7920829.js";import"./_isIterateeCall-6629e32d.js";import"./useGenInfoDiff-2e71db8c.js";const Be=u=>(Se("data-v-896f3f7e"),u=u(),ye(),u),Ue={class:"hint"},Le={class:"action-bar"},Ne=Be(()=>c("div",{style:{padding:"16px 0 512px"}},null,-1)),Pe={key:1},Ee={class:"no-res-hint"},Je={class:"hint"},We={key:2,class:"preview-switch"},Ke=fe({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(u){const k=u,d=ve(!0),g=ze(t=>be({...k.selectedTagIds,random_sort:d.value},t)),{queue:E,images:i,onContextMenuClickU:b,stackViewEl:J,previewIdx:p,previewing:x,onPreviewVisibleChange:W,previewImgMove:M,canPreview:T,itemSize:A,gridItems:K,showGenInfo:f,imageGenInfo:V,q:O,multiSelectedIdxs:h,onFileItemClick:q,scroller:I,showMenuIdx:w,onFileDragStart:Q,onFileDragEnd:X,cellWidth:Y,onScroll:C,saveAllFileAsJson:j,props:H,saveLoadedFileAsJson:Z,changeIndchecked:ee,seedChangeChecked:te,getGenDiff:le,getGenDiffWatchDep:se}=Ge(g);_(()=>k.selectedTagIds,async()=>{var t;await g.reset(),await G(),(t=I.value)==null||t.scrollToItem(0),C()},{immediate:!0}),_(d,async()=>{var t;await g.reset(),await G(),(t=I.value)==null||t.scrollToItem(0),C()}),_(()=>k,async t=>{H.value=t},{deep:!0,immediate:!0});const ie=ke(),{onClearAllSelected:ne,onSelectAll:ae,onReverseSelect:oe}=De(),de=()=>{i.value.length!==0&&P(i.value,0)};return(t,l)=>{const re=$e,ce=Ce,ue=_e,v=N,pe=N,me=Me;return m(),S("div",{class:"container",ref_key:"stackViewEl",ref:J},[s(re,{show:!!e(h).length||e(ie).keepMultiSelect,onClearAllSelected:e(ne),onSelectAll:e(ae),onReverseSelect:e(oe)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),s(me,{size:"large",spinning:!e(E).isIdle},{default:n(()=>{var $,D,F;return[s(ue,{visible:e(f),"onUpdate:visible":l[1]||(l[1]=a=>B(f)?f.value=a:null),width:"70vw","mask-closable":"",onOk:l[2]||(l[2]=a=>f.value=!1)},{cancelText:n(()=>[]),default:n(()=>[s(ce,{active:"",loading:!e(O).isIdle},{default:n(()=>[c("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[0]||(l[0]=a=>e(he)(e(V)))},[c("div",Ue,o(t.$t("doubleClickToCopy")),1),r(" "+o(e(V)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),c("div",Le,[s(v,{onClick:l[3]||(l[3]=a=>d.value=!d.value),type:d.value?"primary":"default"},{default:n(()=>[r(o(d.value?"🎲 随机排序":"📅 按日期排序"),1)]),_:1},8,["type"]),s(v,{onClick:de,type:"primary",disabled:!(($=e(i))!=null&&$.length)},{default:n(()=>[r(o(t.$t("tiktokView")),1)]),_:1},8,["disabled"]),s(v,{onClick:e(Z)},{default:n(()=>[r(o(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),s(v,{onClick:e(j)},{default:n(()=>[r(o(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(D=e(i))!=null&&D.length?(m(),U(e(Fe),{key:0,ref_key:"scroller",ref:I,class:"file-list",items:e(i),"item-size":e(A).first,"key-field":"fullpath","item-secondary-size":e(A).second,gridItems:e(K),onScroll:e(C)},{after:n(()=>[Ne]),default:n(({item:a,index:R})=>[s(Re,{idx:R,file:a,"cell-width":e(Y),"show-menu-idx":e(w),"onUpdate:showMenuIdx":l[4]||(l[4]=z=>B(w)?w.value=z:null),onDragstart:e(Q),onDragend:e(X),onFileItemClick:e(q),onTiktokView:(z,ge)=>e(P)(e(i),ge),"full-screen-preview-image-url":e(i)[e(p)]?e(Ie)(e(i)[e(p)]):"",selected:e(h).includes(R),onContextMenuClick:e(b),onPreviewVisibleChange:e(W),"is-selected-mutil-files":e(h).length>1,"enable-change-indicator":e(ee),"seed-change-checked":e(te),"get-gen-diff":e(le),"get-gen-diff-watch-dep":e(se)},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","onTiktokView","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(g).load&&t.selectedTagIds.and_tags.length===1&&!((F=t.selectedTagIds.folder_paths_str)!=null&&F.trim())?(m(),S("div",Pe,[c("div",Ee,[c("p",Je,o(t.$t("tagSearchNoResultsMessage")),1),s(pe,{onClick:l[5]||(l[5]=a=>e(we)()),type:"primary"},{default:n(()=>[r(o(t.$t("rebuildImageIndex")),1)]),_:1})])])):y("",!0),e(x)?(m(),S("div",We,[s(e(Te),{onClick:l[6]||(l[6]=a=>e(M)("prev")),class:L({disable:!e(T)("prev")})},null,8,["class"]),s(e(Ae),{onClick:l[7]||(l[7]=a=>e(M)("next")),class:L({disable:!e(T)("next")})},null,8,["class"])])):y("",!0)]}),_:1},8,["spinning"]),e(x)&&e(i)&&e(i)[e(p)]?(m(),U(Ve,{key:0,file:e(i)[e(p)],idx:e(p),onContextMenuClick:e(b)},null,8,["file","idx","onContextMenuClick"])):y("",!0)],512)}}});const nt=xe(Ke,[["__scopeId","data-v-896f3f7e"]]);export{nt as default};
